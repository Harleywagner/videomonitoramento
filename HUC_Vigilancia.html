<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HUC Video Surveillance System - Monitoramento de Ocorr√™ncias</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #0f1419 100%);
            color: #e0e0e0;
            min-height: 100vh;
            background-attachment: fixed;
        }

        /* Grid Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 212, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 212, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: rgba(15, 20, 25, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            font-size: 28px;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
            font-family: 'Courier New', monospace;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .logo p {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .header-info {
            text-align: right;
            font-size: 12px;
            color: #888;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 24px;
            background: rgba(15, 20, 25, 0.8);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: #e0e0e0;
            cursor: pointer;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-tab:hover {
            border-color: rgba(0, 212, 255, 0.6);
            background: rgba(0, 212, 255, 0.1);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }

        .nav-tab.active {
            background: rgba(0, 212, 255, 0.2);
            border-color: #00d4ff;
            color: #00d4ff;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.4);
        }

        /* Content Sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(15, 20, 25, 0.8);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: rgba(0, 212, 255, 0.6);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
            transform: translateY(-5px);
        }

        .stat-label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
            font-family: 'Courier New', monospace;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid rgba(0, 212, 255, 0.5);
            color: #00d4ff;
            cursor: pointer;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            background: rgba(0, 212, 255, 0.3);
            border-color: #00d4ff;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }

        .btn-success {
            background: rgba(57, 255, 20, 0.2);
            border-color: rgba(57, 255, 20, 0.5);
            color: #39ff14;
        }

        .btn-success:hover {
            background: rgba(57, 255, 20, 0.3);
            border-color: #39ff14;
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.3);
        }

        .btn-danger {
            background: rgba(255, 107, 53, 0.2);
            border-color: rgba(255, 107, 53, 0.5);
            color: #ff6b35;
        }

        .btn-danger:hover {
            background: rgba(255, 107, 53, 0.3);
            border-color: #ff6b35;
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.3);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        /* Filters */
        .filters-container {
            background: rgba(15, 20, 25, 0.8);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.1);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .filter-group input,
        .filter-group select {
            padding: 10px;
            background: rgba(10, 14, 39, 0.8);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: #e0e0e0;
            border-radius: 4px;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: rgba(0, 212, 255, 0.6);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.2);
        }

        /* Table */
        .table-container {
            background: rgba(15, 20, 25, 0.8);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.1);
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: rgba(0, 212, 255, 0.1);
            border-bottom: 2px solid rgba(0, 212, 255, 0.3);
        }

        th {
            padding: 15px;
            text-align: left;
            font-size: 12px;
            color: #00d4ff;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
            font-size: 13px;
        }

        tbody tr {
            transition: all 0.3s ease;
        }

        tbody tr:hover {
            background: rgba(0, 212, 255, 0.05);
            border-left: 3px solid #00d4ff;
        }

        .status-encerrada {
            color: #39ff14;
        }

        .status-andamento {
            color: #ff6b35;
        }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: rgba(15, 20, 25, 0.8);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.1);
        }

        .chart-title {
            font-size: 16px;
            color: #00d4ff;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        canvas {
            width: 100%;
            height: auto;
            max-height: 300px;
        }

        /* Expandable Row */
        .expandable-row {
            cursor: pointer;
        }

        .expand-icon {
            display: inline-block;
            transition: transform 0.3s ease;
            color: #00d4ff;
        }

        .expand-icon.expanded {
            transform: rotate(180deg);
        }

        .details-row {
            display: none;
        }

        .details-row.show {
            display: table-row;
        }

        .details-cell {
            padding: 20px 15px;
            background: rgba(0, 212, 255, 0.05);
            border-left: 3px solid #00d4ff;
        }

        .details-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            font-size: 12px;
        }

        .detail-item {
            padding: 10px;
            background: rgba(10, 14, 39, 0.8);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 4px;
        }

        .detail-label {
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
            font-size: 10px;
        }

        .detail-value {
            color: #e0e0e0;
            word-break: break-word;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            overflow-y: auto;
        }

        .modal.show {
            display: block;
        }

        .modal-content {
            background: linear-gradient(135deg, #0a0e27 0%, #0f1419 100%);
            margin: 5% auto;
            padding: 30px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 0 40px rgba(0, 212, 255, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
            padding-bottom: 15px;
        }

        .modal-header h2 {
            color: #00d4ff;
            font-size: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .close-btn {
            background: none;
            border: none;
            color: #00d4ff;
            font-size: 28px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            color: #ff6b35;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px;
            background: rgba(10, 14, 39, 0.8);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: #e0e0e0;
            border-radius: 4px;
            font-size: 13px;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: rgba(0, 212, 255, 0.6);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.2);
        }

        .form-group textarea {
            grid-column: 1 / -1;
            min-height: 80px;
            resize: vertical;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
            border-top: 1px solid rgba(0, 212, 255, 0.2);
            padding-top: 15px;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 20px;
            color: #888;
            font-size: 12px;
            border-top: 1px solid rgba(0, 212, 255, 0.1);
            margin-top: 30px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 10px;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .header-info {
                text-align: center;
            }

            .modal-content {
                width: 95%;
                margin: 20% auto;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0f1419;
        }

        ::-webkit-scrollbar-thumb {
            background: #1a1f2e;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #00d4ff;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="logo">
                    <h1>VIDEOMONITORAMENTO HUC/ISGH</h1>
                    <p>Sistema de Ocorr√™ncias</p>
                </div>
                <div class="header-info">
                    <div id="currentTime"></div>
                    <div style="margin-top: 5px;">v3.0 - Com Relat√≥rios e PDF</div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="nav-tab" onclick="showTab('occurrences')">üìã Ocorr√™ncias</button>
            <button class="nav-tab" onclick="showTab('reports')">üìà Relat√≥rios</button>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="content-section active">
            <h2 style="color: #00d4ff; margin-bottom: 20px; font-size: 24px; text-transform: uppercase; letter-spacing: 2px;">Dashboard de Monitoramento</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total de Ocorr√™ncias</div>
                    <div class="stat-value" id="totalOccurrences">5</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Encerradas</div>
                    <div class="stat-value" id="resolvedCount" style="color: #39ff14;">4</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Em Andamento</div>
                    <div class="stat-value" id="pendingCount" style="color: #ff6b35;">1</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Taxa de Resolu√ß√£o</div>
                    <div class="stat-value" id="resolutionRate" style="color: #39ff14;">80%</div>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">Ocorr√™ncias por Tipo</div>
                    <canvas id="typeChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Distribui√ß√£o por Turno</div>
                    <canvas id="shiftChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Ocorr√™ncias por Operador</div>
                    <canvas id="operatorChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Status das Ocorr√™ncias</div>
                    <canvas id="statusChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Occurrences Section -->
        <div id="occurrences" class="content-section">
            <h2 style="color: #00d4ff; margin-bottom: 20px; font-size: 24px; text-transform: uppercase; letter-spacing: 2px;">Registro de Ocorr√™ncias</h2>
            
            <div class="btn-group">
                <button class="btn btn-success" onclick="openNewOccurrenceModal()">‚ûï Nova Ocorr√™ncia</button>
            </div>

            <div class="filters-container">
                <div class="filters-grid">
                    <div class="filter-group">
                        <label>Buscar</label>
                        <input type="text" id="searchInput" placeholder="Local, c√¢mera, descri√ß√£o...">
                    </div>
                    <div class="filter-group">
                        <label>Tipo de Ocorr√™ncia</label>
                        <select id="typeFilter">
                            <option value="">Todos os tipos</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Status</label>
                        <select id="statusFilter">
                            <option value="">Todos os status</option>
                            <option value="Encerrada">Encerrada</option>
                            <option value="Em andamento">Em andamento</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Operador</label>
                        <select id="operatorFilter">
                            <option value="">Todos os operadores</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table id="occurrencesTable">
                    <thead>
                        <tr>
                            <th style="width: 30px;"></th>
                            <th>Data/Hora</th>
                            <th>Tipo</th>
                            <th>Local</th>
                            <th>Status</th>
                            <th>Operador</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="content-section">
            <h2 style="color: #00d4ff; margin-bottom: 20px; font-size: 24px; text-transform: uppercase; letter-spacing: 2px;">Relat√≥rios e An√°lises</h2>
            
            <div class="filters-container">
                <div class="filters-grid">
                    <div class="filter-group">
                        <label>Per√≠odo do Relat√≥rio</label>
                        <select id="reportPeriod" onchange="toggleCustomDates()">
                            <option value="all">Todos os registros</option>
                            <option value="today">Hoje</option>
                            <option value="week">√öltima semana</option>
                            <option value="month">Este m√™s</option>
                            <option value="year">Este ano</option>
                            <option value="custom">Per√≠odo customizado</option>
                        </select>
                    </div>
                    <div class="filter-group" id="customDateGroup" style="display: none;">
                        <label>Data Inicial</label>
                        <input type="date" id="reportStartDate">
                    </div>
                    <div class="filter-group" id="customDateGroup2" style="display: none;">
                        <label>Data Final</label>
                        <input type="date" id="reportEndDate">
                    </div>
                </div>
                <div class="btn-group" style="margin-top: 15px;">
                    <button class="btn btn-success" onclick="printReport()">üñ®Ô∏è Imprimir Relat√≥rio</button>
                    <button class="btn btn-success" onclick="downloadHTML()">üì• Baixar HTML</button>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">Ocorr√™ncias por Tipo (Detalhado)</div>
                    <canvas id="reportTypeChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Distribui√ß√£o por Turno (Pizza)</div>
                    <canvas id="reportShiftChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Ocorr√™ncias por Operador (Detalhado)</div>
                    <canvas id="reportOperatorChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Status das Ocorr√™ncias</div>
                    <canvas id="reportStatusChart"></canvas>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Per√≠odo Analisado</div>
                    <div style="color: #e0e0e0; font-size: 14px;" id="periodInfo">Todos os registros</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total no Per√≠odo</div>
                    <div style="color: #e0e0e0; font-size: 14px;" id="periodTotal">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ocorr√™ncia Mais Comum</div>
                    <div style="color: #e0e0e0; font-size: 14px;" id="mostCommon">-</div>
                </div>
            </div>
        </div>

        <footer>
            <p>BY: HARLEYFOUXSTUDIO ¬© 2026 | Sistema de Monitoramento Profissional de Ocorr√™ncias</p>
        </footer>
    </div>

    <!-- Modal para Nova/Editar Ocorr√™ncia -->
    <div id="occurrenceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Nova Ocorr√™ncia</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="occurrenceForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Data do Registro</label>
                        <input type="date" id="registrationDate" required>
                    </div>
                    <div class="form-group">
                        <label>Data da Ocorr√™ncia</label>
                        <input type="date" id="occurrenceDate" required>
                    </div>
                    <div class="form-group">
                        <label>Hora Inicial</label>
                        <input type="time" id="startTime" required>
                    </div>
                    <div class="form-group">
                        <label>Hora Final</label>
                        <input type="time" id="endTime" required>
                    </div>
                    <div class="form-group">
                        <label>Local Monitorado</label>
                        <input type="text" id="location" placeholder="Ex: Sala de seguran√ßa" required>
                    </div>
                    <div class="form-group">
                        <label>C√¢mera</label>
                        <input type="text" id="camera" placeholder="Ex: CAM 47 - 3P" required>
                    </div>
                    <div class="form-group">
                        <label>Tipo de Ocorr√™ncia</label>
                        <select id="type" required>
                            <option value="">Selecione um tipo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Classifica√ß√£o/Status</label>
                        <select id="classification" required>
                            <option value="">Selecione um status</option>
                            <option value="Em andamento">Em andamento</option>
                            <option value="Encerrada">Encerrada</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Operador</label>
                        <select id="operator" required>
                            <option value="">Selecione um operador</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Turno</label>
                        <select id="shift" required>
                            <option value="">Selecione um turno</option>
                            <option value="Diurno">Diurno</option>
                            <option value="Noturno">Noturno</option>
                        </select>
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Descri√ß√£o T√©cnica</label>
                        <textarea id="technicalDescription" placeholder="Descreva o que aconteceu..." required></textarea>
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>A√ß√£o Executada</label>
                        <textarea id="actionTaken" placeholder="Qual a√ß√£o foi tomada?" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>√ìrg√£os Acionados</label>
                        <input type="text" id="agenciesContacted" placeholder="Ex: Bombeiros, Pol√≠cia">
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Observa√ß√µes</label>
                        <textarea id="observations" placeholder="Observa√ß√µes adicionais..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" onclick="closeModal()">Cancelar</button>
                    <button type="submit" class="btn btn-success">Salvar Ocorr√™ncia</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data
        let occurrences = [
            {
                id: 'OC001',
                registrationDate: '2026-01-28',
                occurrenceDate: '2026-01-28',
                startTime: '04:46:40',
                endTime: '04:59:25',
                location: 'Sala de seguran√ßa',
                camera: 'CAM 47 - 3P',
                type: 'Alarme disparado',
                classification: 'Encerrada',
                technicalDescription: 'O alarme de inc√™ndio foi acionado indevidamente.',
                actionTaken: 'Entrei em contato com os bombeiros.',
                agenciesContacted: 'Bombeiros',
                operator: 'Wagner',
                shift: 'Noturno',
                observations: 'O bombeiro Delane resetou o painel de controle, os mesmos ir√£o relatar a poss√≠vel falha do sistema.'
            },
            {
                id: 'OC002',
                registrationDate: '2026-01-29',
                occurrenceDate: '2026-01-29',
                startTime: '08:15:00',
                endTime: '08:30:00',
                location: 'Corredor A',
                camera: 'CAM 02 - Corredor A',
                type: 'Movimento suspeito',
                classification: 'Encerrada',
                technicalDescription: 'Movimento detectado fora do hor√°rio de funcionamento.',
                actionTaken: 'Verifica√ß√£o realizada, sem incidentes.',
                agenciesContacted: 'Nenhuma',
                operator: 'Ernesto',
                shift: 'Diurno',
                observations: 'Falso alarme - Funcion√°rio esquecido no pr√©dio.'
            },
            {
                id: 'OC003',
                registrationDate: '2026-01-29',
                occurrenceDate: '2026-01-29',
                startTime: '14:20:00',
                endTime: '14:35:00',
                location: 'Almoxarifado',
                camera: 'CAM 06 - Almoxarifado',
                type: 'Acesso n√£o autorizado',
                classification: 'Em andamento',
                technicalDescription: 'Tentativa de acesso √† √°rea restrita.',
                actionTaken: 'Bloqueio de acesso ativado, aguardando investiga√ß√£o.',
                agenciesContacted: 'Seguran√ßa',
                operator: 'Glaucia',
                shift: 'Noturno',
                observations: 'Cart√£o de acesso n√£o identificado. Investiga√ß√£o em andamento.'
            },
            {
                id: 'OC004',
                registrationDate: '2026-01-29',
                occurrenceDate: '2026-01-29',
                startTime: '16:45:00',
                endTime: '16:50:00',
                location: 'P√°tio',
                camera: 'CAM 07 - P√°tio',
                type: 'Vandalismo',
                classification: 'Encerrada',
                technicalDescription: 'Danos observados em estrutura externa.',
                actionTaken: 'Documenta√ß√£o fotogr√°fica realizada. Manuten√ß√£o notificada.',
                agenciesContacted: 'Manuten√ß√£o',
                operator: 'Arnaldo',
                shift: 'Diurno',
                observations: 'Danos leves em parede externa. Sem risco de seguran√ßa.'
            },
            {
                id: 'OC005',
                registrationDate: '2026-01-29',
                occurrenceDate: '2026-01-29',
                startTime: '18:00:00',
                endTime: '18:15:00',
                location: 'Estacionamento',
                camera: 'CAM 08 - Estacionamento',
                type: 'Falha de equipamento',
                classification: 'Encerrada',
                technicalDescription: 'C√¢mera 08 apresentou intermit√™ncia de sinal.',
                actionTaken: 'Reinicializa√ß√£o do equipamento realizada.',
                agenciesContacted: 'Tecnologia',
                operator: 'Wagner',
                shift: 'Noturno',
                observations: 'Equipamento normalizado. Monitoramento cont√≠nuo recomendado.'
            }
        ];

        const occurrenceTypes = ['Movimento suspeito', 'Acesso n√£o autorizado', 'Tentativa de furto', 'Furto consumado', 'Vandalismo', 'Viola√ß√£o de per√≠metro', 'Alarme disparado', 'Falha de equipamento', 'Apoio operacional', 'Acidente', 'Confus√£o', 'Outros'];
        const operators = ['Wagner', 'Ernesto', 'Glaucia', 'Arnaldo'];
        const shifts = ['Diurno', 'Noturno'];

        let editingId = null;

        // Initialize
        function init() {
            updateTime();
            setInterval(updateTime, 1000);
            populateFilters();
            populateFormSelects();
            renderOccurrences();
            updateStats();
            drawCharts();
            drawReportCharts();
            loadFromLocalStorage();
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleString('pt-BR');
        }

        function populateFilters() {
            const typeFilter = document.getElementById('typeFilter');
            const operatorFilter = document.getElementById('operatorFilter');

            occurrenceTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                typeFilter.appendChild(option);
            });

            operators.forEach(op => {
                const option = document.createElement('option');
                option.value = op;
                option.textContent = op;
                operatorFilter.appendChild(option);
            });

            document.getElementById('searchInput').addEventListener('input', renderOccurrences);
            document.getElementById('typeFilter').addEventListener('change', renderOccurrences);
            document.getElementById('statusFilter').addEventListener('change', renderOccurrences);
            document.getElementById('operatorFilter').addEventListener('change', renderOccurrences);
        }

        function populateFormSelects() {
            const typeSelect = document.getElementById('type');
            const operatorSelect = document.getElementById('operator');

            occurrenceTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                typeSelect.appendChild(option);
            });

            operators.forEach(op => {
                const option = document.createElement('option');
                option.value = op;
                option.textContent = op;
                operatorSelect.appendChild(option);
            });

            document.getElementById('occurrenceForm').addEventListener('submit', saveOccurrence);
        }

        function updateStats() {
            const total = occurrences.length;
            const resolved = occurrences.filter(o => o.classification === 'Encerrada').length;
            const pending = occurrences.filter(o => o.classification === 'Em andamento').length;
            const rate = total > 0 ? Math.round((resolved / total) * 100) : 0;

            document.getElementById('totalOccurrences').textContent = total;
            document.getElementById('resolvedCount').textContent = resolved;
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('resolutionRate').textContent = rate + '%';
        }

        function getFilteredOccurrences() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const operatorFilter = document.getElementById('operatorFilter').value;

            return occurrences.filter(o => {
                const matchSearch = !search || o.location.toLowerCase().includes(search) || o.camera.toLowerCase().includes(search) || o.technicalDescription.toLowerCase().includes(search);
                const matchType = !typeFilter || o.type === typeFilter;
                const matchStatus = !statusFilter || o.classification === statusFilter;
                const matchOperator = !operatorFilter || o.operator === operatorFilter;
                return matchSearch && matchType && matchStatus && matchOperator;
            });
        }

        function renderOccurrences() {
            const filtered = getFilteredOccurrences();
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            filtered.forEach(occ => {
                const mainRow = document.createElement('tr');
                mainRow.className = 'expandable-row';
                mainRow.innerHTML = `
                    <td><span class="expand-icon">‚ñº</span></td>
                    <td>${occ.occurrenceDate} ${occ.startTime}</td>
                    <td>${occ.type}</td>
                    <td>${occ.location}</td>
                    <td><span class="status-${occ.classification.toLowerCase().replace(/\s+/g, '-')}">${occ.classification}</span></td>
                    <td>${occ.operator}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn" onclick="editOccurrence('${occ.id}')">‚úèÔ∏è Editar</button>
                            <button class="btn btn-danger" onclick="deleteOccurrence('${occ.id}')">üóëÔ∏è Apagar</button>
                        </div>
                    </td>
                `;

                const detailsRow = document.createElement('tr');
                detailsRow.className = 'details-row';
                detailsRow.innerHTML = `
                    <td colspan="7">
                        <div class="details-cell">
                            <div class="details-content">
                                <div class="detail-item">
                                    <div class="detail-label">C√¢mera</div>
                                    <div class="detail-value">${occ.camera}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Descri√ß√£o T√©cnica</div>
                                    <div class="detail-value">${occ.technicalDescription}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">A√ß√£o Executada</div>
                                    <div class="detail-value">${occ.actionTaken}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">√ìrg√£os Acionados</div>
                                    <div class="detail-value">${occ.agenciesContacted}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Dura√ß√£o</div>
                                    <div class="detail-value">${occ.startTime} - ${occ.endTime}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Observa√ß√µes</div>
                                    <div class="detail-value">${occ.observations}</div>
                                </div>
                            </div>
                        </div>
                    </td>
                `;

                mainRow.addEventListener('click', function(e) {
                    if (!e.target.closest('button')) {
                        const icon = mainRow.querySelector('.expand-icon');
                        icon.classList.toggle('expanded');
                        detailsRow.classList.toggle('show');
                    }
                });

                tbody.appendChild(mainRow);
                tbody.appendChild(detailsRow);
            });
        }

        function openNewOccurrenceModal() {
            editingId = null;
            document.getElementById('modalTitle').textContent = 'Nova Ocorr√™ncia';
            document.getElementById('occurrenceForm').reset();
            document.getElementById('registrationDate').valueAsDate = new Date();
            document.getElementById('occurrenceDate').valueAsDate = new Date();
            document.getElementById('occurrenceModal').classList.add('show');
        }

        function editOccurrence(id) {
            const occ = occurrences.find(o => o.id === id);
            if (!occ) return;

            editingId = id;
            document.getElementById('modalTitle').textContent = 'Editar Ocorr√™ncia';
            document.getElementById('registrationDate').value = occ.registrationDate;
            document.getElementById('occurrenceDate').value = occ.occurrenceDate;
            document.getElementById('startTime').value = occ.startTime;
            document.getElementById('endTime').value = occ.endTime;
            document.getElementById('location').value = occ.location;
            document.getElementById('camera').value = occ.camera;
            document.getElementById('type').value = occ.type;
            document.getElementById('classification').value = occ.classification;
            document.getElementById('operator').value = occ.operator;
            document.getElementById('shift').value = occ.shift;
            document.getElementById('technicalDescription').value = occ.technicalDescription;
            document.getElementById('actionTaken').value = occ.actionTaken;
            document.getElementById('agenciesContacted').value = occ.agenciesContacted;
            document.getElementById('observations').value = occ.observations;

            document.getElementById('occurrenceModal').classList.add('show');
        }

        function deleteOccurrence(id) {
            if (confirm('Tem certeza que deseja apagar esta ocorr√™ncia?')) {
                occurrences = occurrences.filter(o => o.id !== id);
                renderOccurrences();
                updateStats();
                drawCharts();
                drawReportCharts();
                saveToLocalStorage();
            }
        }

        function saveOccurrence(e) {
            e.preventDefault();

            const data = {
                registrationDate: document.getElementById('registrationDate').value,
                occurrenceDate: document.getElementById('occurrenceDate').value,
                startTime: document.getElementById('startTime').value,
                endTime: document.getElementById('endTime').value,
                location: document.getElementById('location').value,
                camera: document.getElementById('camera').value,
                type: document.getElementById('type').value,
                classification: document.getElementById('classification').value,
                technicalDescription: document.getElementById('technicalDescription').value,
                actionTaken: document.getElementById('actionTaken').value,
                agenciesContacted: document.getElementById('agenciesContacted').value,
                operator: document.getElementById('operator').value,
                shift: document.getElementById('shift').value,
                observations: document.getElementById('observations').value
            };

            if (editingId) {
                const index = occurrences.findIndex(o => o.id === editingId);
                occurrences[index] = { ...occurrences[index], ...data };
            } else {
                const newId = 'OC' + String(occurrences.length + 1).padStart(3, '0');
                occurrences.push({ id: newId, ...data });
            }

            closeModal();
            renderOccurrences();
            updateStats();
            drawCharts();
            drawReportCharts();
            saveToLocalStorage();
        }

        function closeModal() {
            document.getElementById('occurrenceModal').classList.remove('show');
            editingId = null;
        }

        function showTab(tabName) {
            document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(el => el.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard' || tabName === 'reports') {
                setTimeout(() => {
                    if (tabName === 'dashboard') drawCharts();
                    else drawReportCharts();
                }, 100);
            }
        }

        // Local Storage
        function saveToLocalStorage() {
            localStorage.setItem('occurrences', JSON.stringify(occurrences));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('occurrences');
            if (saved) {
                occurrences = JSON.parse(saved);
                renderOccurrences();
                updateStats();
                drawCharts();
            }
        }

        // Report Functions
        function toggleCustomDates() {
            const period = document.getElementById('reportPeriod').value;
            const group1 = document.getElementById('customDateGroup');
            const group2 = document.getElementById('customDateGroup2');
            
            if (period === 'custom') {
                group1.style.display = 'flex';
                group2.style.display = 'flex';
            } else {
                group1.style.display = 'none';
                group2.style.display = 'none';
            }
        }

        function getReportPeriodDates() {
            const period = document.getElementById('reportPeriod').value;
            const today = new Date();
            let startDate, endDate = new Date(today);

            switch(period) {
                case 'today':
                    startDate = new Date(today);
                    startDate.setHours(0, 0, 0, 0);
                    break;
                case 'week':
                    startDate = new Date(today);
                    startDate.setDate(today.getDate() - 7);
                    break;
                case 'month':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    break;
                case 'year':
                    startDate = new Date(today.getFullYear(), 0, 1);
                    break;
                case 'custom':
                    startDate = new Date(document.getElementById('reportStartDate').value);
                    endDate = new Date(document.getElementById('reportEndDate').value);
                    break;
                default:
                    startDate = new Date('2000-01-01');
            }

            return { startDate, endDate };
        }

        function getFilteredReportOccurrences() {
            const { startDate, endDate } = getReportPeriodDates();
            return occurrences.filter(o => {
                const occDate = new Date(o.occurrenceDate);
                return occDate >= startDate && occDate <= endDate;
            });
        }

        function generateReportHTML() {
            const filtered = getFilteredReportOccurrences();
            const { startDate, endDate } = getReportPeriodDates();
            
            let html = `<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Relat√≥rio de Ocorr√™ncias</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            color: #333;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #000;
            padding-bottom: 20px;
        }
        .header h1 {
            margin: 0;
            font-size: 24px;
        }
        .header p {
            margin: 5px 0;
            font-size: 12px;
            color: #666;
        }
        .info-box {
            background: #f5f5f5;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #0066cc;
        }
        .info-box p {
            margin: 5px 0;
            font-size: 13px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th {
            background: #0066cc;
            color: white;
            padding: 10px;
            text-align: left;
            font-size: 12px;
        }
        td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            font-size: 12px;
        }
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        .summary {
            background: #f0f0f0;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }
        .summary h3 {
            margin-top: 0;
            color: #0066cc;
        }
        .summary-item {
            display: inline-block;
            margin-right: 30px;
            margin-bottom: 10px;
        }
        .summary-item strong {
            color: #0066cc;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>VIDEOMONITORAMENTO HUC/ISGH</h1>
        <p>Relat√≥rio de Ocorr√™ncias</p>
        <p>Gerado em: ${new Date().toLocaleString('pt-BR')}</p>
    </div>

    <div class="info-box">
        <p><strong>Per√≠odo:</strong> ${startDate.toLocaleDateString('pt-BR')} a ${endDate.toLocaleDateString('pt-BR')}</p>
        <p><strong>Total de Ocorr√™ncias:</strong> ${filtered.length}</p>
        <p><strong>Encerradas:</strong> ${filtered.filter(o => o.classification === 'Encerrada').length}</p>
        <p><strong>Em Andamento:</strong> ${filtered.filter(o => o.classification === 'Em andamento').length}</p>
    </div>

    <h3>Detalhes das Ocorr√™ncias</h3>
    <table>
        <thead>
            <tr>
                <th>Data/Hora</th>
                <th>Tipo</th>
                <th>Local</th>
                <th>Status</th>
                <th>Operador</th>
                <th>Turno</th>
                <th>Descri√ß√£o</th>
            </tr>
        </thead>
        <tbody>`;

            filtered.forEach(occ => {
                html += `<tr>
                    <td>${occ.occurrenceDate} ${occ.startTime}</td>
                    <td>${occ.type}</td>
                    <td>${occ.location}</td>
                    <td>${occ.classification}</td>
                    <td>${occ.operator}</td>
                    <td>${occ.shift}</td>
                    <td>${occ.technicalDescription.substring(0, 50)}...</td>
                </tr>`;
            });

            const typeData = {};
            occurrenceTypes.forEach(type => {
                typeData[type] = filtered.filter(o => o.type === type).length;
            });

            const statusData = {
                'Encerrada': filtered.filter(o => o.classification === 'Encerrada').length,
                'Em andamento': filtered.filter(o => o.classification === 'Em andamento').length
            };

            html += `</tbody>
    </table>

    <div class="summary">
        <h3>Resumo Estat√≠stico</h3>
        <div class="summary-item"><strong>Total:</strong> ${filtered.length}</div>
        <div class="summary-item"><strong>Resolvidas:</strong> ${statusData['Encerrada']}</div>
        <div class="summary-item"><strong>Em Andamento:</strong> ${statusData['Em andamento']}</div>
        <div class="summary-item"><strong>Taxa de Resolu√ß√£o:</strong> ${filtered.length > 0 ? Math.round((statusData['Encerrada'] / filtered.length) * 100) : 0}%</div>
    </div>

    <div class="summary" style="margin-top: 30px;">
        <h3>Ocorr√™ncias por Tipo</h3>`;

            Object.entries(typeData).forEach(([type, count]) => {
                if (count > 0) {
                    html += `<div class="summary-item"><strong>${type}:</strong> ${count}</div>`;
                }
            });

            html += `</div>

    <div style="margin-top: 40px; text-align: center; font-size: 11px; color: #999;">
        <p>BY: HARLEYFOUXSTUDIO ¬© 2026 | Sistema de Monitoramento Profissional de Ocorr√™ncias</p>
    </div>
</body>
</html>`;

            return html;
        }

        function printReport() {
            const html = generateReportHTML();
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write(html);
            printWindow.document.close();
            printWindow.print();
        }

        function downloadHTML() {
            const html = generateReportHTML();
            const blob = new Blob([html], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `Relatorio_Ocorrencias_${new Date().toISOString().split('T')[0]}.html`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        }

        // Charts
        function getOccurrencesByType() {
            const counts = {};
            occurrenceTypes.forEach(type => {
                counts[type] = occurrences.filter(o => o.type === type).length;
            });
            return counts;
        }

        function getOccurrencesByShift() {
            const counts = {};
            shifts.forEach(shift => {
                counts[shift] = occurrences.filter(o => o.shift === shift).length;
            });
            return counts;
        }

        function getOccurrencesByOperator() {
            const counts = {};
            operators.forEach(op => {
                counts[op] = occurrences.filter(o => o.operator === op).length;
            });
            return counts;
        }

        function getOccurrencesByStatus() {
            const counts = {};
            counts['Encerrada'] = occurrences.filter(o => o.classification === 'Encerrada').length;
            counts['Em andamento'] = occurrences.filter(o => o.classification === 'Em andamento').length;
            return counts;
        }

        function drawBarChart(canvasId, data, title, color) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const entries = Object.entries(data).filter(([_, count]) => count > 0);

            if (entries.length === 0) {
                ctx.fillStyle = '#888';
                ctx.font = '14px Arial';
                ctx.fillText('Sem dados', 50, 50);
                return;
            }

            const maxCount = Math.max(...entries.map(([_, count]) => count));
            const barWidth = canvas.width / entries.length;
            const padding = 40;
            const chartHeight = canvas.height - padding * 2;

            ctx.fillStyle = '#0a0e27';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.strokeStyle = 'rgba(0, 212, 255, 0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }

            const colors = ['#00d4ff', '#39ff14', '#ff6b35', '#ffd700', '#00ff88', '#ff00ff', '#00ffff', '#ff0055'];

            entries.forEach(([label, count], index) => {
                const x = index * barWidth + barWidth / 4;
                const barHeight = (count / maxCount) * chartHeight;
                const y = canvas.height - padding - barHeight;
                const barColor = colors[index % colors.length];

                const gradient = ctx.createLinearGradient(x, y, x, canvas.height - padding);
                gradient.addColorStop(0, barColor);
                gradient.addColorStop(1, colors[(index + 1) % colors.length]);

                ctx.fillStyle = gradient;
                ctx.fillRect(x, y, barWidth / 2, barHeight);

                ctx.shadowColor = barColor;
                ctx.shadowBlur = 10;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 0;
                ctx.strokeStyle = barColor;
                ctx.lineWidth = 3;
                ctx.strokeRect(x, y, barWidth / 2, barHeight);
                ctx.shadowColor = 'transparent';

                ctx.fillStyle = barColor;
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(count.toString(), x + barWidth / 4, y - 5);

                ctx.fillStyle = '#e0e0e0';
                ctx.font = '10px Arial';
                const shortLabel = label.substring(0, 10);
                ctx.fillText(shortLabel, x + barWidth / 4, canvas.height - padding + 15);
            });
        }

        function drawPieChart(canvasId, data) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const entries = Object.entries(data);

            ctx.fillStyle = '#0a0e27';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(canvas.width, canvas.height) / 2 - 40;

            const total = entries.reduce((sum, [_, count]) => sum + count, 0);
            const colors = ['#00d4ff', '#39ff14', '#ff6b35', '#ffd700', '#00ff88'];

            let currentAngle = -Math.PI / 2;

            entries.forEach(([label, count], index) => {
                const sliceAngle = (count / total) * Math.PI * 2;
                const sliceColor = colors[index % colors.length];

                ctx.fillStyle = sliceColor;
                ctx.globalAlpha = 0.8;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fill();

                ctx.shadowColor = sliceColor;
                ctx.shadowBlur = 15;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 0;
                ctx.strokeStyle = sliceColor;
                ctx.globalAlpha = 1;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.stroke();
                ctx.shadowColor = 'transparent';

                const labelAngle = currentAngle + sliceAngle / 2;
                const labelX = centerX + Math.cos(labelAngle) * (radius * 0.7);
                const labelY = centerY + Math.sin(labelAngle) * (radius * 0.7);

                ctx.fillStyle = '#0a0e27';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(count.toString(), labelX, labelY);

                currentAngle += sliceAngle;
            });

            ctx.fillStyle = '#00d4ff';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'left';

            let legendY = 30;
            entries.forEach(([label, count], index) => {
                ctx.fillStyle = colors[index % colors.length];
                ctx.fillRect(10, legendY, 12, 12);
                ctx.fillStyle = '#e0e0e0';
                ctx.textAlign = 'left';
                ctx.font = '11px Arial';
                ctx.fillText(label + ': ' + count, 28, legendY + 10);
                legendY += 20;
            });
        }

        function drawCharts() {
            const typeData = getOccurrencesByType();
            const shiftData = getOccurrencesByShift();
            const operatorData = getOccurrencesByOperator();
            const statusData = getOccurrencesByStatus();

            drawBarChart('typeChart', typeData, 'Ocorr√™ncias por Tipo', '#00d4ff');
            drawPieChart('shiftChart', shiftData);
            drawBarChart('operatorChart', operatorData, 'Ocorr√™ncias por Operador', '#39ff14');
            drawBarChart('statusChart', statusData, 'Status das Ocorr√™ncias', '#ff6b35');
        }

        function drawReportCharts() {
            const filtered = getFilteredReportOccurrences();
            
            const typeData = {};
            const shiftData = { 'Diurno': 0, 'Noturno': 0 };
            const operatorData = {};
            const statusData = { 'Encerrada': 0, 'Em andamento': 0 };
            
            occurrenceTypes.forEach(type => typeData[type] = 0);
            operators.forEach(op => operatorData[op] = 0);
            
            filtered.forEach(o => {
                typeData[o.type]++;
                shiftData[o.shift]++;
                operatorData[o.operator]++;
                statusData[o.classification]++;
            });

            drawBarChart('reportTypeChart', typeData, 'Ocorr√™ncias por Tipo', '#00d4ff');
            drawPieChart('reportShiftChart', shiftData);
            drawBarChart('reportOperatorChart', operatorData, 'Ocorr√™ncias por Operador', '#39ff14');
            drawBarChart('reportStatusChart', statusData, 'Status das Ocorr√™ncias', '#ff6b35');

            const typeEntries = Object.entries(typeData).filter(([_, count]) => count > 0);
            if (typeEntries.length > 0) {
                const mostCommon = typeEntries.sort((a, b) => b[1] - a[1])[0][0];
                document.getElementById('mostCommon').textContent = mostCommon;
            }

            const { startDate, endDate } = getReportPeriodDates();
            document.getElementById('periodInfo').textContent = startDate.toLocaleDateString('pt-BR') + ' a ' + endDate.toLocaleDateString('pt-BR');
            document.getElementById('periodTotal').textContent = filtered.length;
        }

        window.onclick = function(event) {
            const modal = document.getElementById('occurrenceModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        init();
    </script>
</body>
</html>
